<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="jp">
<head>
<title>
リバーシプログラムの作り方
</title>
</head>
<body background="../img/bg.gif" bgcolor="#ffffff" text="#000000" link="#0000ff" vlink="#0000ff" alink="#9900ff">
<a href="../index.html">＜目次＞</a>
<a href="8_4.html">＜前へ＞</a>
<a href="8_6.html">＜次へ＞</a>
<table width="600" border="0" cellpadding="3">
<tr bgcolor="#333399">
<td>
<font size=+1 color="#ffffff">
<b>8.5 局面の登録と取得</b>
</font>
</td>
</tr>
</table>
<p>
本節では局面情報の登録と取得処理を実装します。<br>
また残りのHashクラスの関数も実装します。<br>
</p>
<p>
<ul>
<li><b>局面情報の登録</b>
<p>
局面情報を登録する関数Hash_Set()は以下のようになっています。<br>
ハッシュ値からインデックスを求め、対応する領域にハッシュ値と局面情報をコピーします。<br>
常に局面情報を上書きするので単純な実装になっています。<br>
</p>
<p>
<pre>
int Hash_Set(Hash *self, const HashValue *in_value, const HashInfo *in_info)
{
	int i;

	i = in_value->Low &amp; self->Mask;
	memcpy(&amp;self->Data[i].Value, in_value, sizeof(HashValue));
	memcpy(&amp;self->Data[i].Info, in_info, sizeof(HashInfo));
	return 1;
}
</pre>
</p>
<li><b>局面情報の取得</b>
<p>
次に局面情報取得関数Hash_Get()を実装します。<br>
処理としては、インデックスの計算、ハッシュ値の比較、ハッシュ値が一致していたら局面情報をコピーする、の３つを行っています。<br>
またGetNumとHitNumの更新もします。<br>
</p>
<p>
<pre>
int Hash_Get(Hash *self, const HashValue *in_value, HashInfo *out_info)
{
	int i;

	i = in_value->Low &amp; self->Mask;
	self->GetNum++;
	if (self->Data[i].Value.Low == in_value->Low &amp;&amp; self->Data[i].Value.High == in_value->High) {
		memcpy(out_info, &amp;self->Data[i].Info, sizeof(HashInfo));
		self->HitNum++;
		return 1;
	}
	return 0;
}
</pre>
</p>
<li><b>その他の関数</b>
<p>
残りの関数も実装を行いましょう。<br>
</p>
<p>
<pre>
void Hash_ClearInfo(Hash *self)
{
	self->GetNum = 0;
	self->HitNum = 0;
}

int Hash_CountGet(Hash *self)
{
	return self->GetNum;
}

int Hash_CountHit(Hash *self)
{
	return self->HitNum;
}
</pre>
</p>
<p>
どれも単純な実装です。<br>
Hash_ClearInfo()ではGetNumとHitNumの初期化、Hash_CountGet()とHash_CountHit()は対応するメンバ変数の値を返しているだけです。<br>
</p>
</ul>
<p>
次節では、置換表を利用した探索を行います。<br>
</p>
<a href="../index.html">＜目次＞</a>
<a href="8_4.html">＜前へ＞</a>
<a href="8_6.html">＜次へ＞</a>
<hr>
&copy;2006 Daiki Sanno, All Rights Reserved<br>
<a href="mailto:support@es-cube.net">mailto:support@es-cube.net</a><br>
</body>
</html>
