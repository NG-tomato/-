<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="jp">
<head>
<title>
リバーシプログラムの作り方
</title>
</head>
<body background="../img/bg.gif" bgcolor="#ffffff" text="#000000" link="#0000ff" vlink="#0000ff" alink="#9900ff">
<a href="../index.html">＜目次＞</a>
<a href="6_4.html">＜前へ＞</a>
<a href="6_6.html">＜次へ＞</a>
<table width="600" border="0" cellpadding="3">
<tr bgcolor="#333399">
<td>
<font size=+1 color="#ffffff">
<b>6.5 局面情報の取得と登録</b>
</font>
</td>
</tr>
</table>
<p>
前節で局面の検索を行なえるようになりました。<br>
本節では局面情報の取得と登録を行なえるようにします。
</p>
<ul>
<li><b>局面情報の取得</b>
<p>
局面情報を取得する関数Opening_Info()は以下のようになっています。<br>
与えられた局面から局面情報を選択し、見つかったらout_infoに格納しています。<br>
</p>
<p>
<pre>
int Opening_Info(const Opening *self, const Board *in_board, int in_color, PositionInfo *out_info)
{
	PositionInfo *info;

	info = Opening_Find(self, in_board, in_color);
	if (!info) {
		return 0;
	}
	*out_info = *info;
	return 1;
}
</pre>
</p>
<li><b>局面情報の登録</b>
<p>
次に局面情報の登録関数です。<br>
Opening_SetInfo()は以下のようになっています。<br>
</p>
<p>
<pre>
int Opening_SetInfo(Opening *self, const Board *in_board, int in_color, const PositionInfo *in_info)
{
	PositionInfo *info;
	PositionData *data;

	info = Opening_Find(self, in_board, in_color);
	if (info) {
		*info = *in_info;
	} else {
		if (self->Num >= self->Max) {
			self->Max += NUM_INFO_BLOCK;
			data = realloc(self->Data, self->Max * sizeof(PositionData));
			if (!data) {
				return 0;
			}
			self->Data = data;
		}
		Board_Key(in_board, in_color, &amp;self->Data[self->Num].key);
		self->Data[self->Num].info = *in_info;
		self->Num++;
	}
	return 1;
}
</pre>
</p>
<p>
目的の局面情報が見つかれば、渡された情報をコピーします。<br>
見つからなかった場合には空いている定石データ領域に登録します。<br>
定石データ領域に空きがなければ、メモリ領域の確保を行なって定石データ領域の拡張を行います。<br>
</p>
</ul>
<p>
本節でOpeningクラスの説明は終わりです。<br>
次節からはOpeningクラスを使用した定石の探索と、定石の登録について説明します。<br>
</p>
<a href="../index.html">＜目次＞</a>
<a href="6_4.html">＜前へ＞</a>
<a href="6_6.html">＜次へ＞</a>
<hr>
&copy;2006 Daiki Sanno, All Rights Reserved<br>
<a href="mailto:support@es-cube.net">mailto:support@es-cube.net</a><br>
</body>
</html>
